
# S3 (Simple Storage Service)

* **Object-based storage** (store files, as opposed to OS/DB/app which goes in **block storage - EBS**)
* Unlimited storage, each file 0-5TB
* Files stored in buckets - folder with universal namespace (name must be unique globally)
* URL format https://s3-region-name-1.amazonaws.com/bucket_name
* HTTP code 200 when upload is successful

Global view in console. Buckets are deployed to a region.

Objects are private by default, if bucket is left private when created.
To make objects public, the entire bucket can be made "can be public" prior.

Read the [FAQ](https://aws.amazon.com/s3/faqs/)

## Data consistency

* Immediate consistency for PUTS of new objects
* Eventual consistency for overwrite PUTS and DELETES

## Key-Value Store
S3 is object based. Objects have:

* Key (name of file)
* Value (sequence of bytes)
* Version ID
* Metadata
* Subresources: ACL, policies, torrent

## Availabilty

* Durability 99.99%
* Availabilty 99.999999999%

## Tiered storage

* S3 standard: HA - can sustain the loss of 2 facilities concurrently. Only S3 service with no retrieval fee.
* S3 IA (infrequently accessed): for files not frequently accessed that require rapid access. Lower fee but retrieval fee.
* S3 Reduced Redundancy (One Zone IA): Lower cost than IA but less resilience
* Glacier: archival only. Retrieval time 3-5h for standard. Can be expedited, bulk or std.

## Charges

* storage per Gb
* requests per number of requests
* storage mgmt pricing (metadata)
* data transfer (across regions)
* transfer acceleration (uses CloudFront for fast transfer across regions)

## Encryption

Client side
Server side
  - S3 Managed keys (SSE-S3)
  - KMS (SSE-KMS)
  - Custom Provider Keys (SSE-C)

## Versioning

Properties > Versioning > Enable versioning
Once enabled, it can be suspended but not disabled.
Each latest version is made private (even if file was made public previously)

With versioning on, when deleting a file a "delete marker" is created and it shows along with all the versions of the file.
To restore deleted file, delete the "delete marker".
Object versions keep permissions (e.g. if it used to be public and is restored, it will be public)

MFA can be enabled to restrict deletion.

Integrates with lifecycle rules

https://docs.aws.amazon.com/AmazonS3/latest/dev/ObjectVersioning.html

## Cross-region replication

Create new bucket. Versioning must be enabled in both source and destination. Regions must be unique.
Go to original bucket > mgmt > replication. Creates role for CRR.
New objects and modifications are automatically replicated.
To replicate original objects, use CLI: `aws s3 cp --recursive s3://source-bucket s3://destination-bucket`
Object deletions are not automatically replicated.

Cannot replicate multiple buckets or daisy-chaining.

## Lifecycle management

With or without versioning.

Automation to expire or transition to other S3 tiers.
Bucket > mgmt > lifecycle
Can transition both current and/or previous verions.

Transition to *where* after *how many days*
Expire (delete) after *how many days*


secure data with acl and policies
